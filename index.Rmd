---
output: html_document
---

## INBO drat repository

A [drat](http://dirk.eddelbuettel.com/code/drat.html) repository is a way to make [R packages](https://www.r-project.org) more easily available to end users.

How to use it:

1. Make sure that you have the `drat` package installed
1. Add this repo to your current session `drat::addRepo("inbo")`
1. Use `install.packages()` or `update.packages()` to install or update the packages

```{r setup, include = FALSE}
library(knitr)
opts_chunk$set(echo = FALSE)
library(dplyr)
library(purrr)
library(tidyr)
```

```{r read-data}
package <- list.files(
  pattern = "PACKAGES$",
  recursive = TRUE,
  full.names = TRUE
)
os <- ifelse(
  grepl("src", package),
  1,
  ifelse(
    grepl("windows", package), 2, 3)
) %>%
  factor(labels = c("Source", "Windows", "OS X"))
dataset <- map(package, read.dcf, fields = c("Package", "Version")) %>%
  map(as_data_frame) %>%
  map2_df(os, ~mutate(.x, OS = .y)) %>%
  extract(
    Version, 
    into = c("Major", "Minor", "Detail"), 
    regex = "([[:digit:]]+)\\.([[:digit:]]+)\\.([[:digit:]]+)",
    remove = FALSE
  ) %>%
  arrange(Package, desc(Major), desc(Minor), desc(Detail))
```

## Latest version of available packages

The package name links to a website with the documentation of the package.

```{r latest}
dataset %>%
  select(Package, Version, OS) %>%
  mutate(Package = sprintf("[%1$s](docs/%1$s/index.html)", Package)) %>%
  group_by(Package, OS) %>%
  slice(1) %>%
  spread(OS, Version) %>%
  kable()
```

## All available versions

### Source packages

```{r source}
list.files("src/contrib", pattern = "tar.gz$") %>%
  data_frame() %>%
  select(file = 1) %>%
  mutate(
    version = gsub(".tar.gz", "", file),
    url = paste0("src/contrib/", file)
  ) %>%
  extract(version, c("Package", "version"), regex = "(.*)_(.*)") %>%
  mutate(markdown = sprintf("[%s](%s)", version, url)) %>%
  group_by(Package) %>%
  summarise(Versions = paste(markdown, collapse = ", ")) %>%
  kable()
```

### Windows binaries

```{r windows}
list.files("bin/windows/contrib", pattern = "zip$", recursive = TRUE) %>%
  data_frame() %>%
  select(file = 1) %>%
  mutate(
    version = gsub(".zip", "", file),
    url = paste0("bin/windows/contrib/", file)
  ) %>%
  extract(version, c("R", "Package", "version"), regex = "(.*)/(.*)_(.*)") %>%
  mutate(markdown = sprintf("[%s](%s)", version, url)) %>%
  group_by(R, Package) %>%
  summarise(Versions = paste(markdown, collapse = ", ")) %>%
  kable()
```

### Mac OS X binaries

```{r macosx}
list.files("bin/macosx", pattern = "tgz$", recursive = TRUE) %>%
  data_frame() %>%
  select(file = 1) %>%
  mutate(
    version = gsub(".tgz", "", file) %>%
      gsub(pattern = "contrib/", replacement = ""),
    url = paste0("bin/macosx/", file)
  ) %>%
  extract(
    version, 
    c("OS", "R", "Package", "version"), 
    regex = "(.*)/(.*)/(.*)_(.*)"
  ) %>%
  mutate(markdown = sprintf("[%s](%s)", version, url)) %>%
  group_by(OS, R, Package) %>%
  summarise(Versions = paste(markdown, collapse = ", ")) %>%
  kable()
```
